<?xml version="1.0" encoding="UTF-8"?>
<project name="ant build for portal" basedir="." default="build-unix">
	<property file="build.properties" />

	<target name="build-unix" depends="init">
		<ant antfile="${basedir}/build-mvn.xml" target="common.compile-unix" />
		<ant antfile="${basedir}/build-mvn.xml" target="framework.compile-unix" />
		<ant antfile="${basedir}/build-mvn.xml" target="osgi.compile-unix" />
		<ant antfile="${basedir}/build-mvn.xml" target="logger.compile-unix" />
		<ant antfile="${basedir}/build-mvn.xml" target="server.compile-unix" />
		<ant antfile="${basedir}/build-mvn.xml" target="bus.compile-unix" />
		<ant antfile="${basedir}/build-mvn.xml" target="depends-unix" />
		<antcall target="make" /> 
	</target>
	
	<target name="build-unix-notest" depends="init">
		<ant antfile="${basedir}/build-mvn.xml" target="common.compile-unix.notest" />
		<ant antfile="${basedir}/build-mvn.xml" target="framework.compile-unix.notest" />
		<ant antfile="${basedir}/build-mvn.xml" target="osgi.compile-unix.notest" />
		<ant antfile="${basedir}/build-mvn.xml" target="logger.compile-unix.notest" />
		<ant antfile="${basedir}/build-mvn.xml" target="server.compile-unix.notest" />
		<ant antfile="${basedir}/build-mvn.xml" target="bus.compile-unix.notest" />
		<ant antfile="${basedir}/build-mvn.xml" target="depends-unix" />
		<antcall target="make" /> 
	</target>
	
	<target name="build-win" depends="init">
		<ant antfile="${basedir}/build-mvn.xml" target="common.compile-win" />
		<ant antfile="${basedir}/build-mvn.xml" target="framework.compile-win" />
		<ant antfile="${basedir}/build-mvn.xml" target="osgi.compile-win" />
		<ant antfile="${basedir}/build-mvn.xml" target="logger.compile-win" />
		<ant antfile="${basedir}/build-mvn.xml" target="server.compile-win" />
		<ant antfile="${basedir}/build-mvn.xml" target="bus.compile-win" />
		<ant antfile="${basedir}/build-mvn.xml" target="depends-win" />
		<antcall target="make" />
	</target>
	
	<target name="build-win-notest" depends="init">
		<ant antfile="${basedir}/build-mvn.xml" target="common.compile-win.notest" />
		<ant antfile="${basedir}/build-mvn.xml" target="framework.compile-win.notest" />
		<ant antfile="${basedir}/build-mvn.xml" target="osgi.compile-win.notest" />
		<ant antfile="${basedir}/build-mvn.xml" target="logger.compile-win.notest" />
		<ant antfile="${basedir}/build-mvn.xml" target="server.compile-win.notest" />
		<ant antfile="${basedir}/build-mvn.xml" target="bus.compile-win.notest" />
		<ant antfile="${basedir}/build-mvn.xml" target="depends-win" />
		<antcall target="make" />
	</target>

	
	<target name="make">
		<copy todir="${app.portal.lib}">
			<fileset dir="${target.depends}">
				<include name="com.antelope.ci.bus.framework-0.1.0.jar" />
				<include name="com.antelope.ci.bus-0.1.0.jar" />
			</fileset>
		</copy>

		<copy todir="${app.portal.lib.ext}">
			<fileset dir="${target.depends}">
				<include name="log4j*.jar" />
				<include name="slf4j*.jar" />
				<include name="com.antelope.ci.bus.common-0.1.0.jar" />
				<include name="com.antelope.ci.bus.osgi-0.1.0.jar" />
			</fileset>
		</copy>

		<copy todir="${app.portal.system}">
			<fileset dir="${target.depends}">
				<include name="org.apache.felix.bundlerepository*.jar" />
				<include name="org.apache.felix.gogo*.jar" />
			</fileset>
		</copy>
		
		<copy todir="${app.portal.system.ext}">
			<fileset dir="${target.depends}">
				<include name="com.antelope.ci.bus.logger*.jar" />
			</fileset>
		</copy>
		
		<copy todir="${app.portal.bundle}">
			<fileset dir="${target.depends}">
				<include name="com.antelope.ci.bus.server*.jar" />
			</fileset>
		</copy>
		
		<copy todir="${app.portal.bundle.lib}">
			<fileset dir="${target.depends}">
				<include name="mina*.jar" />
				<include name="sshd*.jar" />
			</fileset>
		</copy>
		
		<copy todir="${app.portal.etc}">
			<fileset dir="${prj.bus.etc}" />
		</copy>
		
		<copy todir="${app.portal.bin}">
			<fileset dir="${script.root}" />
		</copy>
	</target>

	<target name="init" depends="clean">
		<mkdir dir="${app.portal.root}" />
		<mkdir dir="${app.portal.bin}" />
		<mkdir dir="${app.portal.etc}" />
		<mkdir dir="${app.portal.system}" />
		<mkdir dir="${app.portal.system.ext}" />
		<mkdir dir="${app.portal.bundle}" />
		<mkdir dir="${app.portal.bundle.lib}" />
		<mkdir dir="${app.portal.lib}" />
		<mkdir dir="${app.portal.lib.ext}" />
		<mkdir dir="${app.portal.plugin}" />
		<mkdir dir="${src.portal.root}" />
	</target>

	<target name="clean">
		<delete dir="${app.portal.root}" />
		<delete dir="${src.portal.root}" />
	</target>
</project>