<?xml version="1.0" encoding="UTF-8"?>
<project name="ant build for portal" basedir="." default="build">
	<property file="build.properties" />

	<target name="build" depends="init">
		<ant antfile="${basedir}/build-mvn.xml" target="common.compile" />
		<ant antfile="${basedir}/build-mvn.xml" target="framework.compile" />
		<ant antfile="${basedir}/build-mvn.xml" target="osgi.compile" />
		<ant antfile="${basedir}/build-mvn.xml" target="logger.compile" />
		<ant antfile="${basedir}/build-mvn.xml" target="server.compile" />
		<ant antfile="${basedir}/build-mvn.xml" target="service.userstorefile.compile" />
		<ant antfile="${basedir}/build-mvn.xml" target="portal.compile" />
		<ant antfile="${basedir}/build-mvn.xml" target="bus.compile" />
		<ant antfile="${basedir}/build-mvn.xml" target="depends" />
		<antcall target="make" />
	</target>

	<target name="build-notest" depends="init">
		<ant antfile="${basedir}/build-mvn.xml" target="common.compile.notest" />
		<ant antfile="${basedir}/build-mvn.xml" target="framework.compile.notest" />
		<ant antfile="${basedir}/build-mvn.xml" target="osgi.compile.notest" />
		<ant antfile="${basedir}/build-mvn.xml" target="logger.compile.notest" />
		<ant antfile="${basedir}/build-mvn.xml" target="server.compile.notest" />
		<ant antfile="${basedir}/build-mvn.xml" target="service.userstorefile.compile.notest" />
		<ant antfile="${basedir}/build-mvn.xml" target="portal.compile.notest" />
		<ant antfile="${basedir}/build-mvn.xml" target="bus.compile.notest" />
		<ant antfile="${basedir}/build-mvn.xml" target="depends" />
		<antcall target="make" />
	</target>

	<target name="make">
		<copy todir="${app.portal.lib}">
			<fileset dir="${target.depends}">
				<include name="com.antelope.ci.bus.framework-${bus.version}.jar" />
				<include name="com.antelope.ci.bus-${bus.version}.jar" />
			</fileset>
		</copy>

		<copy todir="${app.portal.lib.ext}">
			<fileset dir="${target.depends}">
				<include name="log4j*.jar" />
				<include name="slf4j*.jar" />
				<include name="com.antelope.ci.bus.common-${bus.version}.jar" />
				<include name="com.antelope.ci.bus.osgi-${bus.version}.jar" />
			</fileset>
		</copy>

		<copy todir="${app.portal.system}">
			<fileset dir="${target.depends}">
				<include name="org.apache.felix.bundlerepository*.jar" />
				<include name="org.apache.felix.gogo*.jar" />
			</fileset>
		</copy>

		<copy todir="${app.portal.system.ext}">
			<fileset dir="${target.depends}">
				<include name="com.antelope.ci.bus.logger-${bus.version}.jar" />
			</fileset>
		</copy>

		<copy todir="${app.portal.server.bundle}">
			<fileset dir="${target.depends}">
				<include name="com.antelope.ci.bus.server-${bus.version}.jar" />
			</fileset>
		</copy>
		
		<copy todir="${app.portal.system.ext}">
			<fileset dir="${target.depends}">
				<include name="com.antelope.ci.bus.server.service.userstore.file-${bus.version}.jar" />
			</fileset>
		</copy>

		<!--
		<copy todir="${app.portal.server.bundle.lib}">
			<fileset dir="${target.depends}">
				<include name="mina*.jar" />
				<include name="sshd*.jar" />
			</fileset>
		</copy>
		-->
		
		<copy todir="${app.portal.bundle}">
			<fileset dir="${target.depends}">
				<include name="com.antelope.ci.bus.portal-${bus.version}.jar" />
			</fileset>
		</copy>
		
		<!--
		<copy todir="${app.portal.bundle.lib}">
			<fileset dir="${target.depends}">
				<include name="mina*.jar" />
				<include name="sshd*.jar" />
			</fileset>
		</copy>
		-->
		
		<copy todir="${app.portal.system.lib}">
			<fileset dir="${target.depends}">
				<include name="mina*.jar" />
				<include name="sshd*.jar" />
			</fileset>
		</copy>

		<copy todir="${app.portal.etc}">
			<fileset dir="${prj.bus.etc}" />
		</copy>

		<copy todir="${app.portal.bin}">
			<fileset dir="${script.root}" />
		</copy>
	</target>

	<target name="init" depends="clean">
		<mkdir dir="${app.portal.root}" />
		<mkdir dir="${app.portal.bin}" />
		<mkdir dir="${app.portal.etc}" />
		<mkdir dir="${app.portal.system}" />
		<mkdir dir="${app.portal.system.lib}" />
		<mkdir dir="${app.portal.system.ext}" />
		<mkdir dir="${app.portal.server.bundle}" />
		<mkdir dir="${app.portal.server.bundle.lib}" />
		<mkdir dir="${app.portal.bundle}" />
		<mkdir dir="${app.portal.bundle.lib}" />
		<mkdir dir="${app.portal.lib}" />
		<mkdir dir="${app.portal.lib.ext}" />
		<mkdir dir="${app.portal.plugin}" />
		<mkdir dir="${src.portal.root}" />
	</target>

	<target name="clean">
		<delete dir="${app.portal.root}" />
		<delete dir="${src.portal.root}" />
	</target>
</project>