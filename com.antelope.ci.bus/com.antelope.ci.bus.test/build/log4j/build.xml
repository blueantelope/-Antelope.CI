<?xml version="1.0" encoding="UTF-8"?>
<project name="osgi-demo" basedir=".">
	<property file="../build.properties" />

	<target name="install-modules">
		<exec executable="cmd" failonerror="true">
			<arg line="/c" />
			<arg line="mvn" />
			<arg line="install" />
		</exec>
	</target>

	<target name="deploy-dependencies-to-server-repository" depends="install-modules">
		<exec executable="cmd">
			<arg line="/c" />
			<arg line="mvn" />
			<arg line="-f ../osgi.demo.par/pom.xml" />
			<arg line="dependency:copy-dependencies" />
			<arg value="-Dvirgo.location=${virgo.location}" />
			<arg value="-DexcludeGroupIds=osgi.demo,com.google.gwt" />
			<arg value="-DexcludeArtifactIds=spring4gwt" />
		</exec>
	</target>
	
	<target name="test.win" depends="init">
		<exec executable="cmd">
			<arg line="/c cd ${basedir}/${test.dir}" />
			<arg line="/c test.bat" />
		</exec>
	</target>
	
	<target name="init" depends="clean">
		<mkdir dir="${test.dir}" /> 
		<mkdir dir="${test.bundle.dir}" /> 
		<mkdir dir="${test.bin.dir}" />
		<mkdir dir="${test.conf.dir}" />
		
		<copydir src="${bundle.dir}" dest="${test.bundle.dir}" />
		<copydir src="${bin.dir}" dest="${test.bin.dir}" />
		<copydir src="${conf.dir}" dest="${test.conf.dir}" />
		<copy file="${test.bat}" todir="${test.dir}" />
	</target>
	
	<target name="clean">
		<delete dir="${test.dir}" />
	</target>

</project>